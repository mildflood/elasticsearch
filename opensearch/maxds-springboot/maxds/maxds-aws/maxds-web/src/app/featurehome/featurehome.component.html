<div>
  <p-progressSpinner *ngIf="progressSpinner" [style]="{width: '50px', height: '50px',float:'left'}" strokeWidth="8"
    fill="#EEEEEE" animationDuration=".5s"></p-progressSpinner>
  <p-messages [value]="msgs"></p-messages>
</div>
<p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000"></p-confirmDialog>
<div *ngIf="showError" class="alert alert-danger" role="alert">
  <strong>{{errorMsg}}</strong>
</div>
<div class="row p-y-5" *ngIf="processnow" style="border-style: solid;">
  <div class="col-xs-12 col-lg-3 input-wrapper">
    <label>Division -> Sector:</label>
    <p-dropdown [options]="filtereddivSector" placeholder="Select Division Sector" [(ngModel)]="divSector"
      [style]="{'width':'90%'}" dropdownIcon="pi pi-chevron-down" (onChange)="divSectorChange(divSector)"
      [virtualScroll]="true" [itemSize]="31" filter="true"></p-dropdown>
    <span>
      {{divisionCount}}
    </span>
  </div>

  <div class="col-xs-12 col-lg-3 input-wrapper">
    <label>Industry:</label>
    <p-dropdown [options]="filteredindustry" [(ngModel)]="industry" placeholder="Select Industry" [showClear]="true"
      (onChange)="processIndustryChange(industry)" [virtualScroll]="true" [itemSize]="31" filter="true"
      [style]="{'width':'90%'}"></p-dropdown>
    <span>
      {{sectorCount}}
    </span>
  </div>

  <div class="col-xs-12 col-lg-3 input-wrapper">
    <label>Filer Category:</label>
    <p-dropdown [options]="filteredfilerCategory" [(ngModel)]="filerCategory" placeholder="Select Filer Category"
      [showClear]="true" (onChange)="processfilCatChange(filerCategory)" [virtualScroll]="true" [itemSize]="31"
      filter="true" [style]="{'width':'90%'}"></p-dropdown>
    <span>
      {{categoryCount}}
    </span>
  </div>

  <div class="col-xs-12 col-lg-3 input-wrapper">
    <label style="height: 14px; width: 100%;"></label>
    <button pButton type="button" label="Process Now" class=" ui-button ui-button-success" [disabled]="enableTermButton"
      (click)="processNow()"></button>
  </div>
</div>

<div style="width: 100vw; height: 92.5vh;">

  <as-split direction="horizontal" [useTransition]="true" (gutterClick)="onGutterClick($event)" (dragEnd)="onDragEnd($event)"  >
  <!-- <as-split-area size="20"> -->
      <as-split-area [size]="areas[0].size" order="areas[0].order" >

      <p-tree [value]="termTree" [filter]="true" [style]="{width: '100%','text-align':'left','overflow':'auto'}"
        filterMode="strict" (onNodeSelect)="termTreeSelection($event)" selectionMode="single"
        [(selection)]="selectedTerm" (onNodeUnselect)="termTreeunselect($event)" joyrideStep="termRuleSelection"
        [stepContent]="termRuleSelectionSection" title="Term Rule Selection" [filterPlaceholder]="'Search term rule'">
      </p-tree>
    </as-split-area>
   <!--  <as-split-area size="80"> -->
      <as-split-area [size]="areas[1].size" order="areas[1].order" >

      <as-split direction="vertical">
        <as-split-area size="65">
          <div class="row">
            <div class="col-lg-5 col-xs-12" style="padding: 50px 30px;">

              <div class="row" p-y-5>
                <div class="col-xs-12 col-lg-6 input-wrapper">
                  <label>Term Name</label>
                  <input id="termNameinput" type="text" size="30" pInputText [(ngModel)]="termName"
                  (ngModelChange)="onTermNameChange($event)"
                    joyrideStep="termName" title="Term Name"
                    text="The Term Name displays the name of the selected term.">
                </div>

                <div class="col-xs-12 col-lg-6 input-wrapper">
                  <label>Term Code</label>
                  <input id="termCodeinput" type="text" size="30" pInputText [(ngModel)]="termCode"
                    (ngModelChange)="termCodeChange($event)" [disabled]="enableTermCode" joyrideStep="termCode"
                    title="Term Code" text="The Term Code displays the code for the selected term. ">
                </div>
              </div>

              <div class="row p-y-5 ">
                <div class="col-12 input-wrapper">
                  <label>Definition</label>
                  <textarea rows="5" cols="30" [(ngModel)]="definition" pInputTextarea joyrideStep="definition"
                  (ngModelChange)="onTermDefinitionChange($event)"
                    title="Definition" text="Definition"></textarea>
                </div>
              </div>

              <div class="row p-y-5 ">
                <div class="col-12">
                  <div class="">
                    <p-checkbox class="float-left" [(ngModel)]="incAccuTest" binary="true"
                      joyrideStep="IncludeInAccuracyTest" title="Included in Accuracy Test"
                      (onChange)="onIncAccuTest($event)"
                      text="This check box identifies whether or the not the selected term is displayed in the Accuracy Test. ">
                    </p-checkbox>
                    <label class="float-left p-x-5">Included in Accuracy Test</label>
                  </div>
                </div>
              </div>

              <div class="row p-y-5 ">
                <div class="col-xs-12 col-lg-6  input-wrapper">
                  <label>Period Type</label>
                  <p-dropdown [options]="periodTypeList" [style]="{'width':'100%'}" placeholder="Period Type"
                    [(ngModel)]="periodType" optionLabel="name" [style]="{'width':'200px'}"
                    (onChange)="onPeriodTypeChange($event)"
                    dropdownIcon="pi pi-chevron-down" style="text-align: center" filter="true" joyrideStep="periodType"
                    title="Period Type" [stepContent]="periodTypeSection">
                  </p-dropdown>
                </div>

                <div class="col-xs-12 col-lg-6 input-wrapper">
                  <label>Type</label>
                  <p-dropdown [options]="typeList" [style]="{'width':'100%'}" placeholder="Type" [(ngModel)]="type"
                    optionLabel="name" [style]="{'width':'200px'}" dropdownIcon="pi pi-chevron-down"
                    style="text-align: center" filter="true" joyrideStep="type" title="Type"
                    (onChange)="onTypeChange($event)"
                    [stepContent]="typeSection">
                  </p-dropdown>
                </div>
              </div>

              <div class="row p-y-5 ">
                <div class="col-xs-12 col-lg-6 input-wrapper">
                  <label>Financial Statement</label>
                  <p-dropdown [options]="trmRulFinStatmntList" [style]="{'width':'100%'}"
                    placeholder="Financial Statement" [(ngModel)]="finStatement" optionLabel="financialStatement"
                    [style]="{'width':'200px'}" dropdownIcon="pi pi-chevron-down" style="text-align: center"
                    filter="true" joyrideStep="financialStatement" title="Financial Statement"
                    (onChange)="onFinStatemenChange($event)"
                    [stepContent]="financialStatementSection"></p-dropdown>
                </div>
                <div class="col-xs-12 col-lg-6 input-wrapper">
                  <label>Priority Group</label>
                  <p-dropdown [options]="trmRulPriorGrpList" [style]="{'width':'100%'}" placeholder="Priority Group"
                    [(ngModel)]="priorgroup" optionLabel="name" [style]="{'width':'200px'}"
                    dropdownIcon="pi pi-chevron-down" style="text-align: center" filter="true"
                    (onChange)="onPriorgroupChange($event)"
                    joyrideStep="priorityGroup" title="Priority Group" [stepContent]="priorityGroupSection">
                  </p-dropdown>
                </div>
              </div>

              <div class="row p-y-5 ">
                <div class="col-6 input-wrapper">
                  <label>Processing Order: {{processingOrder}}</label>
                </div>
              </div>

              <div class="row p-y-5 text-center">
                <div class="col-12">
                  <button pButton type="button" label="Add Term" class="ui-button m-x-5" (click)="addTerm()"
                    [disabled]="enableAddTermButton" joyrideStep="addTerm" title="Add Term"
                    [stepContent]="addTermSection"></button>
                  <button pButton type="button" label="Save Term" class="ui-button m-x-5" [disabled]="enableTermButton"
                    (click)="saveTerm()" joyrideStep="saveTerm" title="Save Term"
                    text="The User can click on the “Save Term” to save the term"></button>
                  <button pButton type="button" label="Process Term" class="ui-button m-x-5"
                    [disabled]="enableTermButton" (click)="processTermnow()" joyrideStep="processTerm"
                    title="Process Term"
                    text="The user can click on the “Process Term” to process the term results for a group of companies based on the option the user selected. "></button>
                  <button pButton type="button" label="Remove Term" class="ui-button m-x-5"
                    [disabled]="enableTermButton" (click)="removeTerm()" joyrideStep="removeTerm" title="Remove Term"
                    [stepContent]="removeTermSection"></button>
                </div>
              </div>


            </div>
            <div class="col-lg-7 col-xs-12" style=" padding-right: 50px; ">
              <!-- This feature is not for this release this is for next release -->
              <!-- <div class="12" style="float: right;">
                <label> Start Tour</label>
                <p-inputSwitch (onChange)="startTour($event)" [(ngModel)]="tour"></p-inputSwitch>
              </div> -->
              <div class="row" *ngIf="displayTerms">

                <div class="12 p-y-5">
                  <button pButton type="button" label="{{expLabel}}" class="ui-button m-x-5  ui-button-warning"
                    (click)="expressionClick()" joyrideStep="expLabel" title="{{expLabel}}"
                    [stepContent]="expLabelSection"></button>

                  <button pButton type="button" label="Expressions" class="ui-button m-x-5 ui-button-success"
                    (click)="onExpressionButtonClick('expressions')"></button>
                  <button pButton type="button" label="Validations" class="ui-button m-x-5 ui-button-success"
                    (click)="onExpressionButtonClick('validations')"></button>
                  <button pButton type="button" label="Industry Override Expressios"
                    class="ui-button m-x-5 ui-button-success" (click)="onExpressionButtonClick('industry')"
                    icon="pi pi-check"></button>

                  <button pButton type="button" label="Derived Zero Expressions"
                    class="ui-button m-x-5 ui-button-success" (click)="onExpressionButtonClick('derived')"
                    icon="pi pi-check"></button>
                  <p-dropdown *ngIf="indOvrdExprDrop" [style]="{'width':'100%'}" [options]="indovrDrpList"
                    [(ngModel)]="selIndOvrdExpr" optionLabel="name" (onChange)="industryChange()"></p-dropdown>
                </div>
                <div class="12">
                  <p-table #expressionTable [columns]="expressioncols" [value]="expTableList" [paginator]="true"
                    [rows]="10" [responsive]="true" [rowsPerPageOptions]="[10,20,30]" [resizableColumns]="true"
                    [reorderableColumns]="true" selectionMode="single" [(selection)]="termId" dataKey="termId"
                    p-dataTable [scrollable]="true" scrollHeight="400px">
                    <ng-template pTemplate="colgroup" let-columns>
                      <colgroup>
                        <col *ngFor="let col of columns" [style.width]="col.width">
                      </colgroup>
                    </ng-template>
                    <ng-template pTemplate="header" let-columns>
                      <tr>
                        <th *ngFor="let col of columns" pResizableColumn pReorderableColumn
                          [pSortableColumn]="col.field">
                          <div pTooltip="Click to sort {{col.header}}">
                            {{col.header}}
                            <p-sortIcon [field]="col.field" ariaLabel="Activate to sort"
                              ariaLabelDesc="Activate to sort in descending order"
                              ariaLabelAsc="Activate to sort in ascending order">
                            </p-sortIcon>
                          </div>
                        </th>
                      </tr>
                      <tr>
                        <th *ngFor="let col of columns" [ngSwitch]="col.field" pResizableColumn pReorderableColumn>
                          <div *ngIf="col.field !== ''">
                            <input *ngSwitchCase="col.field" pInputText type="text" placeholder="Search"
                              [value]="expressionTable.filters[col.field] ? expressionTable.filters[col.field].value : ''"
                              (input)="expressionTable.filter($event.target.value, col.field, 'contains');"
                              style="width: 100%;">
                          </div>
                        </th>
                      </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                      <tr style="height:34px">
                        <td *ngFor="let col of columns " class="ui-resizable-column" style="word-wrap:break-word">
                          <div *ngIf="col.field === 'rank'">

                            <a href="#" (click)="moveRankBy(rowIndex, -1)" *ngIf="rowIndex > 0" title="Move row up">
                              <i class="fa fa-arrow-up" aria-hidden="true"></i>
                            </a><br>
                            {{rowData[col.field]}}<br>
                            <a href="#" (click)="moveRankBy(rowIndex, 1)" *ngIf="expTableList.length - rowIndex > 1"
                              title="Move row down">
                              <i class="fa fa-arrow-down" aria-hidden="true"></i>
                            </a>

                          </div>
                          <div *ngIf="col.field !== 'rank' && col.field !== 'options' && col.field !== 'expression'">
                            {{rowData[col.field]}}
                          </div>
                          <div *ngIf="col.field === 'expression'">
                            <div *ngIf="rowData['type'] !== 'Formula'">
                              {{rowData[col.field]}}
                            </div>

                            <div *ngIf="rowData['type'] === 'Formula'">
                              <p style="display:inline" *ngFor="let formula of rowData['formulaList']">
                                <a href="#"
                                  (click)="showTermResultnavigate($event,formula.termName)">{{formula.termName}}
                                </a>
                                {{getFormulaSuffix(formula)}}
                              </p>
                              <!-- {{rowData[col.field]}} -->
                              <button type="button" class="glyphicon  glyphicon-eye-open" pTooltip="Expression Tree"
                                (click)="showDerivationTree()"></button>
                            </div>
                          </div>

                          <div *ngIf="col.field === 'options'">
                            <button type="button" pButton (click)="onExpressionEdit(rowData)"
                              (keydown.enter)="onExpressionEdit(rowData)" icon="pi pi-pencil"
                              styleClass="ui-button-info" pTooltip="Edit Expression"></button>
                            &nbsp;&nbsp;
                            <button type="button" pButton (click)="deleteWithRank(rowIndex)"
                              (keydown.enter)="deleteWithRank(rowIndex)" icon="pi pi-trash" styleClass="ui-button-info"
                              pTooltip="Delete Expression"></button>
                          </div>
                        </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="loadingbody" let-columns="columns">
                      <tr style="height:34px">
                        <td *ngFor="let col of columns" pTooltip="{{rowData[col.field]}}">
                          <div class="loading-text"></div>
                        </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="summary">
                      Total number of Records: {{expressionTable.totalRecords}}
                    </ng-template>
                  </p-table>
                </div>
                <!-- <div class="col-12 m-y-5 text-center">
                  <button pButton type="button" label="Expressions" class="ui-button m-x-5 ui-button-success"
                    (click)="onExpressionButtonClick('expressions')"></button>
                  <button pButton type="button" label="Validations" class="ui-button m-x-5 ui-button-success"
                    (click)="onExpressionButtonClick('validations')"></button>
                  <button pButton type="button" label="Industry Override Expressios"
                    class="ui-button m-x-5 ui-button-success" (click)="onExpressionButtonClick('industry')"
                    icon="pi pi-check"></button>
                  <button pButton type="button" label="Derived Zero Expressions"
                    class="ui-button m-x-5 ui-button-success" (click)="onExpressionButtonClick('derived')"
                    icon="pi pi-check"></button>
                </div> -->
              </div>
            </div>
          </div>
        </as-split-area>
        <as-split-area size="35" *ngIf="displayTerms">
          <div class="row">
            <div class="col-12">
              <div class="row" style="text-align: center">
                <label style="background-color: #E2E8EC;width: 100%"> Coverage and Term Results</label>
              </div>
              <div class="row" style=" padding: 15px 30px; ">
                <div class="col-7">
                  <div class="row p-y-5">
                    <div class="col-12" input-wrapper>
                      <p-radioButton class="float-left" name="filterRadio" value="company" [(ngModel)]="filterRadio">
                      </p-radioButton>
                      <label>Search by Company: </label>
                    </div>
                    <div class="col-6" input-wrapper>
                      <p-autoComplete [(ngModel)]="companyName" class="company-name-wrapper" name="companyName"
                        [size]="50" [suggestions]="filteredCompany" (completeMethod)="searchCompany($event)"
                        (onSelect)="onCompanyNameChange($event)"
                        placeholder="Search Company" [size]="50" [dropdown]="true">

                        <ng-template let-value pTemplate="item">
                          <div class="ui-helper-clearfix">
                            <span [innerHTML]="value | highlight : toHighlight"></span>
                          </div>
                        </ng-template>
                      </p-autoComplete>
                    </div>
                    <div class="col-xs-12 col-lg-6  p-0">
                      <button pButton type="button" label="Go To Peer Goup" class="ui-button p-x-5"
                        (click)="goToPeer($event)"></button>
                      <button type="button" pButton style="margin-left: 15px;" (click)="resetCoverage()"
                        label="Clear All" class="ui-button p-x-5" pTooltip="Clear All"></button>
                    </div>
                  </div>
                  <div class="row p-y-5">
                    <div class="col-12">
                      <p-radioButton class="float-left" name="filterRadio" value="group" [(ngModel)]="filterRadio">
                      </p-radioButton>
                      <label>Search by Group:
                        Division -> Sector:</label>
                    </div>
                    <div class="col-6">
                      <p-dropdown [options]="filtereddivSector" placeholder="Select Division Sector"
                        [(ngModel)]="divSector" [style]="{'width':'100%'}" dropdownIcon="pi pi-chevron-down"
                        (onChange)="divSectorChange(divSector)" [virtualScroll]="true" [itemSize]="31" filter="true">
                      </p-dropdown>
                    </div>
                    <div class="col-1 p-y-5">
                      {{divisionCount}}
                    </div>
                  </div>
                  <div class="row p-y-5">
                    <div class="col-12 input-wrapper">
                      <label>Industry: </label>

                    </div>
                    <div class="col-6">
                      <p-dropdown [options]="filteredindustry" [(ngModel)]="industry" placeholder="Select Industry"
                        [showClear]="true" (onChange)="processIndustryChange(industry)" [virtualScroll]="true"
                        [itemSize]="31" filter="true" [style]="{'width':'100%'}"></p-dropdown>

                    </div>
                    <div class="col-1 p-y-5">
                      <span>{{industryCount}}</span>
                      <!-- <span *ngIf="!industryCount">{{divisionCount}}</span> -->
                    </div>
                  </div>

                  <div class="row p-y-5">
                    <div class="col-12 input-wrapper">
                      <label>Filer Category:</label>

                    </div>
                    <div class="col-6">
                      <p-dropdown [options]="filteredfilerCategory" [(ngModel)]="filerCategory"
                        placeholder="Select Filer Category" [showClear]="true"
                        (onChange)="processfilCatChange(filerCategory)" [virtualScroll]="true" [itemSize]="31"
                        filter="true" [style]="{'width':'100%'}"></p-dropdown>
                    </div>
                    <div class="col-1 p-y-5">
                      <span>{{categoryCount}}</span>
                      <!-- <span *ngIf="!categoryCount">{{divisionCount}}</span> -->
                    </div>
                  </div>

                  <div class="row p-y-5">
                    <div class="col-xs-12 col-lg-6 ">
                      <p-dropdown [options]="resolvedRanks" class="" [(ngModel)]="selectResolvedRank"
                        placeholder="Show Resolved By Rank" (onChange)="showResolved(true)" [style]="{'width':'100%'}">
                      </p-dropdown>
                    </div>
                    <div class="col-xs-12 col-lg-6" style="padding: 0px;">
                      <button pButton type="button" [style]="{'width':'100%'}" label="Show Resolved" class="ui-button"
                        (click)="showResolved(true)"></button>
                      <button pButton style="margin-left: 15px;" type="button" label="Show Not Resolved"
                        class="ui-button" (click)="showResolved(false)"></button>
                    </div>
                  </div>
<!--
                  <div class="row p-y-5">
                    <div class="col-4">
                      <p-checkbox class="float-left" [(ngModel)]="quaterly" binary="true" label="Quarterly?" (onChange)="quaterlyChange($event)">
                      </p-checkbox>
                    </div>
                  </div>

                  <div class="row p-y-5 " style="visibility: hidden">
                    <div class="col-6">
                      <h3 style="text-align: center"> {{range[0]}} - {{range[1]}} </h3>
                      <p-slider [(ngModel)]="range" [min]="minRange" [max]="maxRange" [step]="1" [range]="true"
                        (onChange)="yearChange($event)"></p-slider>
                    </div>
                  </div>
-->
                </div>

                <!-- <div class="col-5 text-center" *ngIf="displayGetCoverage">
                  <div mk-morris-js [options]="chartDonutOptions" [data]="chart" type="Donut"></div>
                  <button pButton type="button" label="Get Coverage" class="ui-button ui-button-success"
                    (click)="showResolved(true)"></button>
                </div> -->
              </div>

              <div class="row  p-y-5 m-y-5" *ngIf="displayTerms">
                <div class="col-12">
                  <p-table #entityTable [columns]="entitycols" [value]="entityList" [paginator]="true" [rows]="10"
                    [responsive]="true" [rowsPerPageOptions]="[10,20,30]" [resizableColumns]="true"
                    [reorderableColumns]="true" selectionMode="single" [(selection)]="cik" dataKey="cik"
                    (onRowSelect)="onRowClick($event)" (onRowUnselect)="onRowUnClick($event)" p-dataTable
                    scrollHeight="100px" [scrollable]="true" scrollHeight="200px">
                    <ng-template pTemplate="colgroup" let-columns>
                      <colgroup>
                        <col *ngFor="let col of columns" [style.width]="col.width">
                      </colgroup>
                    </ng-template>
                    <ng-template pTemplate="header" let-columns>
                      <tr>
                        <th *ngFor="let col of columns" pResizableColumn pReorderableColumn
                          [pSortableColumn]="col.field">
                          <div pTooltip="Click to sort {{col.header}}">
                            {{col.header}}
                            <p-sortIcon [field]="col.field" ariaLabel="Activate to sort"
                              ariaLabelDesc="Activate to sort in descending order"
                              ariaLabelAsc="Activate to sort in ascending order">
                            </p-sortIcon>
                          </div>
                        </th>
                      </tr>
                      <tr>
                        <th *ngFor="let col of columns" [ngSwitch]="col.field">
                          <div *ngIf="col.field !== ''">
                            <input *ngSwitchCase="col.field" pInputText type="text" placeholder="Search"
                              [value]="entityTable.filters[col.field] ? entityTable.filters[col.field].value : ''"
                              (input)="entityTable.filter($event.target.value, col.field, 'contains'); onRowUnClick();onFilter($event.target.value, col.field, 'contains')"
                              style="width: 100%;">
                          </div>
                        </th>
                      </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-rowData let-columns="columns">
                      <tr style="height:34px">
                        <td *ngFor="let col of columns">
                          <div
                            *ngIf="col.field !== 'viewResultLink' && col.field !== 'researchLink' && col.field !== 'processTermLink'">
                            {{rowData[col.field]}}
                          </div>
                          <div *ngIf="col.field === 'viewResultLink'">
                          <a style="color:blue;" (click)="showTermResults(rowData)" href="javascript:void(0)" pTooltip="Click to view processing result for {{this.termCode}}">View</a>
                          </div>
                          <div *ngIf="col.field === 'researchLink'">
                            <a style="color:blue;" target="_blank"
                              href="https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&type=&dateb=&owner=exclude&count=40&search_text=&CIK={{rowData.cik}}">Research</a>
                          </div>
                          <div *ngIf="col.field === 'fsqvLink'">
                               <a (click)="openFSQVLink(rowData)"
                                style="cursor: pointer; color: blue;">FSQV</a>
                        </div>
                          <div *ngIf="col.field === 'processTermLink'">
                            <a style="color:blue;" (click)="processTermForEntity(rowData)" href="#/home">Process</a>
                          </div>
                        </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="loadingbody" let-columns="columns">
                      <tr style="height:34px">
                        <td *ngFor="let col of columns" pTooltip="{{rowData[col.field]}}">
                          <div class="loading-text"></div>
                        </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="summary">
                      Total number of Records: {{entityTable.totalRecords}}
                    </ng-template>
                  </p-table>
                </div>

              </div>
            </div>
          </div>
        </as-split-area>
      </as-split>
    </as-split-area>
  </as-split>
</div>

<p-dialog header="Term Expression Builder" [(visible)]="editExpression" [modal]="true"
  [style]="{width: '95vw', overflow: 'auto'}" [baseZIndex]="10000" position="top" [contentStyle]="{'max-height':'70vh'}"
  [draggable]="true" [resizable]="true" [focusOnShow]="true" [blockScroll]="true">
  <div *ngIf="showValidation" class="alert alert-danger" role="alert">
    <strong>{{validationMessage}}</strong>
  </div>
  <div class="row" p-y-5>
    <div class="col-xs-6 col-lg-3 input-wrapper">
      <label>Term Name:</label>
      <textarea pInputTextarea [(ngModel)]="termName" disabled></textarea>
    </div>

    <div class="col-xs-6 col-lg-6 input-wrapper">
      <label>Definition:</label>
      <textarea pInputTextarea [(ngModel)]="definition" disabled></textarea>
    </div>

    <div class="col-xs-6 col-lg-3 input-wrapper">
      <label>Term Code:</label>
      <textarea pInputTextarea [(ngModel)]="termCode" disabled></textarea>
    </div>
  </div>
  <div>
    <p-tabView [activeIndex]="index" (onChange)="onTabChange($event)">
      <p-tabPanel header="Concept Match" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row">
          <div class="col-xs-12 col-lg-6">
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-6 input-wrapper">
                <label>Concept Name:</label>

                <p-autoComplete required="true" [(ngModel)]="concMatch" [suggestions]="filteredconcMat"
                  (completeMethod)="filterConceptMatch($event)" field="id" [size]="170" placeholder="Concept Match"
                  [minLength]="3" (ngModelChange)="getconceptNameDefinition()"></p-autoComplete>
                <div class="padding-5" style="background-color: #ccc; text-align: left">
                  {{conceptNameDefinition}}
                </div>
              </div>
            </div>
            <div class="row  p-y-5">
              <div class="col-12">
                <div>
                  <p-checkbox label="Use Positive Facts Only" [(ngModel)]="usePositiveFacts" binary="true"></p-checkbox>
                  &nbsp;&nbsp;
                </div>
                <div>
                  <p-checkbox label="Use Negative Facts Only" [(ngModel)]="useNegativeFacts" binary="true"></p-checkbox>
                  &nbsp;&nbsp;
                </div>
                <div>
                  <p-checkbox label="Reverse Negative Facts" [(ngModel)]="revNegativeFacts" binary="true"></p-checkbox>
                </div>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-6 input-wrapper">
                <label>Axis:</label>

                <input type="text" pInputText [(ngModel)]="axis" placeholder="specify axis name">
              </div>
            </div>

            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-6 input-wrapper">
                <label>Members Exclusion (Virtual Parent):</label>

                <textarea pInputTextarea [(ngModel)]="virtualFactMemberExclusions"
                  placeholder="Enter Exclusion Members"></textarea>
              </div>
            </div>
          </div>
        </div>

      </p-tabPanel>
      <p-tabPanel header="Concept Match w/ Dim" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row">
          <div class="col-xs-12 col-lg-12">
            <div class="row" p-y-5>
              <div class="col-xs-12 col-lg-6 input-wrapper">
                <label>Concept Name:</label>

                <p-autoComplete required="true" [(ngModel)]="concMatch" [suggestions]="filteredconcMat"
                  (completeMethod)="filterConceptMatch($event)" field="id" placeholder="Concept Match" [minLength]="3"
                  (ngModelChange)="getconceptNameDefinition()">
                </p-autoComplete>
                <div class="padding-5" style="background-color: #ccc; text-align: left">
                  {{conceptNameDefinition}}
                </div>
              </div>

              <div class="col-xs-12 col-lg-6 input-wrapper">

                <p-checkbox name="useMaxAxisCount" value="useMaxAxisCount" label="Max # Axes/Members:"
                  [(ngModel)]="useMaxAxisCount" inputId="useMaxAxisCount"></p-checkbox>&nbsp;
                <input type="number" min="0" id="maxAxisCount" name="maxAxisCount" [(ngModel)]="maxAxisCount">
              </div>
            </div>

            <div class="row p-y-5" *ngFor="let expressionSet of expressionSets; let i = index" [attr.data-index]="i">

              <div class="col-lg-12">
                <div class="row p-y-5">
                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>Axes:
                      <p-radioButton name="axisOption{{i}}" value="ExactMatch" [(ngModel)]="expressionSet.axisType"
                        id="axisFullNameOption"
                        (onClick)="OnExpressionAxisTypeChanged(i); expressionSet.disableAxes=false;expressionSet.disableAxesInc=true">
                      </p-radioButton>
                    </label>
                    <input type="text" size="30" pInputText [(ngModel)]="expressionSet.axisName"
                      placeholder="specify axis name" [disabled]="expressionSet.disableAxes">
                  </div>
                </div>

                <div class="row p-y-5">
                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>
                      <p-radioButton name="axisOption{{i}}" id="axisPartialNameOption" value="InclusionExclusionList"
                        [(ngModel)]="expressionSet.axisType"
                        (onClick)="OnExpressionAxisTypeChanged(i);expressionSet.disableAxesInc=false;expressionSet.disableAxes=true">
                      </p-radioButton>
                      Inclusions(axis name must
                      contain the list of words):
                    </label>
                    <textarea pInputTextarea id="axisInclusionList" name="axisInclusionList"
                      [disabled]="expressionSet.disableAxesInc" placeholder="Enter Inclusion Axes"
                      [(ngModel)]="expressionSet.axisInclusionListAsString" cols="50" placeholder="Enter Exclusion Axes"
                      (onChange)="expressionSet.axisInclusionList = buildListFromString(expressionSet.axisInclusionListAsString)"></textarea>
                  </div>


                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>
                      Exclusions (axis name must NOT
                      contain the list of words):
                    </label>
                    <textarea pInputTextarea id="axisExclusions" name="axisExclusions"
                      [disabled]="expressionSet.disableAxesInc" [(ngModel)]="expressionSet.axisExclusionListAsString"
                      cols="50" placeholder="Enter Exclusion Axes"
                      (onChange)="expressionSet.axisExclusionList = buildListFromString(expressionSet.axisExclusionListAsString)"></textarea>
                  </div>
                </div>

                <div class="row p-y-5">
                  <div class="col-lg-12 p-y-0">
                    <label>
                      Members:
                    </label>

                    <label>
                      <p-radioButton name="memberOption{{i}}" id="anyMemberOption" value="Any"
                        [(ngModel)]="expressionSet.memberType" (onClick)="OnExpressionMemberTypeChanged(i)">
                      </p-radioButton>
                      Any Members:
                    </label>
                    <div class="p-y-5">
                      <p-radioButton name="memberOption{{i}}" value="ExactMatch" [(ngModel)]="expressionSet.memberType"
                        (onClick)="OnExpressionMemberTypeChanged(i); expressionSet.disableMember=false;expressionSet.disableMemInc=true">
                      </p-radioButton>
                      <input type="text" size="30" pInputText [(ngModel)]="expressionSet.memberName"
                        placeholder="specify member name" [disabled]="expressionSet.disableMember">

                    </div>
                  </div>
                </div>

                <div class="row p-y-5">
                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>
                      <p-radioButton name="memberOption{{i}}" value="InclusionExclusionList"
                        [(ngModel)]="expressionSet.memberType" inputId="partialMemberOption"
                        (onClick)="OnExpressionMemberTypeChanged(i);expressionSet.disableMember=true; expressionSet.disableMemInc=false">
                      </p-radioButton>
                      Inclusions(member name must
                      contain the list of words):
                    </label>
                    <textarea pInputTextarea [(ngModel)]="expressionSet.memberInclusionListAsString" cols="50"
                      placeholder="Enter Exclusion Members" [disabled]="expressionSet.disableMemInc"
                      (onChange)="expressionSet.memberInclusionList = buildListFromString(expressionSet.memberInclusionListAsString)"></textarea>
                  </div>


                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>
                      Exclusions (member name must NOT
                      contain the list of words):
                    </label>
                    <textarea pInputTextarea [(ngModel)]="expressionSet.memberExclusionListAsString" cols="50"
                      placeholder="Enter Exclusion Members" [disabled]="expressionSet.disableMemInc"
                      (onChange)="expressionSet.memberExclusionList = buildListFromString(expressionSet.memberExclusionListAsString)"></textarea>
                  </div>
                </div>
              </div>
              <div class="col-lg-12 text-center">
                <button type="button" pButton icon="pi pi-times" (click)="removeSet(i)" label="Remove Set"
                  class="ui-button ui-button-success"></button>
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 text-center">
                <button type="button" pButton icon="pi pi-check" (click)="AddExpressionSet()" label="Add New Set"
                  class="ui-button ui-button-success"></button>
              </div>
            </div>

          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Extended Check" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row">
          <div class="col-xs-12 col-lg-4">
            <div class="row">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Element Name Contains:
                </label>
                <textarea pInputTextarea [(ngModel)]="nameContains" cols="40" rows="5" placeholder="Name Contains"
                  (ngModelChange)="updateNameContains(nameContains)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Element Name does not Contain:
                </label>
                <textarea pInputTextarea [(ngModel)]="nameDoesNotContains" cols="40" rows="5"
                  placeholder="Name Does Not Contain"
                  (ngModelChange)="updateNameNotContains(nameDoesNotContains)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Balance Type:
                </label>
                <div>
                  &nbsp; <p-radioButton name="ExtendedGroup" value="debit" label="Debit" [(ngModel)]="balType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="ExtendedGroup" value="credit" label="Credit" [(ngModel)]="balType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="ExtendedGroup" value="na" label="NA" [(ngModel)]="balType">
                  </p-radioButton> &nbsp;
                  <p-radioButton name="ExtendedGroup" value="none" label="Ignore" [(ngModel)]="balType">
                  </p-radioButton> &nbsp;
                </div>
              </div>
            </div>

            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Period Type:
                </label>
                <div>
                  &nbsp; <p-radioButton name="perTypeGroup" value="instant" label="Instant" [(ngModel)]="perType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="perTypeGroup" value="duration" label="duration" [(ngModel)]="perType">
                  </p-radioButton>
                  &nbsp;

                </div>
                <div class="p-y-5">
                  &nbsp; <p-checkbox [(ngModel)]="isShareItemType" binary="true" label="Share Item Type? ">
                  </p-checkbox>

                </div>
              </div>
            </div>
          </div>
          <div class="col-xs-12 col-lg-8" style="background-color: #ccc;">
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-4 input-wrapper">
                <label>
                  Division ->
                  Sector:</label>
                <p-dropdown [options]="filtereddivSector" placeholder="Select Division Sector" [(ngModel)]="divSector"
                  [style]="{'width':'100%'}" dropdownIcon="pi pi-chevron-down" (onChange)="divSectorChange(divSector)"
                  [virtualScroll]="true" [itemSize]="31" filter="true">
                </p-dropdown>
                &nbsp; {{divisionCount}}

              </div>
              <div class="col-xs-12 col-lg-4 input-wrapper">
                <label>Industry: </label>

                <p-dropdown [options]="filteredindustry" [(ngModel)]="industry" placeholder="Select Industry"
                  [showClear]="true" (onChange)="processIndustryChange(industry)" [virtualScroll]="true" [itemSize]="31"
                  filter="true" [style]="{'width':'100%'}">
                </p-dropdown>
                &nbsp; {{sectorCount}}
              </div>
              <div class="col-xs-12 col-lg-4 input-wrapper">

                <label>Filer Category:</label>
                <p-dropdown [options]="filteredfilerCategory" [(ngModel)]="filerCategory"
                  placeholder="Select Filer Category" [showClear]="true" (onChange)="processfilCatChange(filerCategory)"
                  [virtualScroll]="true" [itemSize]="31" filter="true" [style]="{'width':'100%'}">
                </p-dropdown>&nbsp;
                {{categoryCount}}
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12">
                <p-table #expressionTable [columns]="expressioncols" [value]="expTableList" [paginator]="true"
                  [rows]="10" [responsive]="true" [rowsPerPageOptions]="[10,20,30]" [resizableColumns]="true"
                  [reorderableColumns]="true" selectionMode="single" [(selection)]="termId" dataKey="termId"
                  (onRowSelect)="onRowClick($event)" (onRowUnselect)="onRowUnClick($event)" p-dataTable
                  scrollHeight="100px" [scrollable]="true" scrollHeight="200px">

                </p-table>
              </div>
            </div>
            <div class="row p-y-5">

              <div class="col-lg-12 text-center">
                <button type="button" pButton (click)="resolve()" label="Resolve"
                  class="ui-button m-x-5 ui-button-info"></button>&nbsp;
                <button type="button" pButton (click)="editExpression=false" label="Include"
                  class="ui-button m-x-5 ui-button-info"></button>&nbsp;
                <button type="button" pButton (click)="editExpression=false" label="Exclude"
                  class="ui-button m-x-5 ui-button-info"></button>&nbsp;
              </div>
            </div>
          </div>

        </div>
      </p-tabPanel>
      <p-tabPanel header="Extended Check w/ Dim" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row">
          <div class="col-xs-12 col-lg-4">
            <div class="row">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Element Name Contains:
                </label>
                <textarea pInputTextarea [(ngModel)]="nameContains" cols="40" rows="5" placeholder="Name Contains"
                  (ngModelChange)="updateNameContains(nameContains)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Element Name does not Contain:
                </label>
                <textarea pInputTextarea [(ngModel)]="nameDoesNotContains" cols="40" rows="5"
                  placeholder="Name Does Not Contain"
                  (ngModelChange)="updateNameNotContains(nameDoesNotContains)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Balance Type:
                </label>
                <div>
                  &nbsp; <p-radioButton name="ExtendedGroup" value="debit" label="Debit" [(ngModel)]="balType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="ExtendedGroup" value="credit" label="Credit" [(ngModel)]="balType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="ExtendedGroup" value="na" label="NA" [(ngModel)]="balType">
                  </p-radioButton> &nbsp;
                  <p-radioButton name="ExtendedGroup" value="none" label="Ignore" [(ngModel)]="balType">
                  </p-radioButton> &nbsp;
                </div>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Period Type:
                </label>
                <div>
                  &nbsp; <p-radioButton name="radioGroup1" value="instant" label="Instant" [(ngModel)]="perType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="radioGroup1" value="duration" label="duration" [(ngModel)]="perType">
                  </p-radioButton>
                  &nbsp;

                </div>
                <div class="p-y-5">
                  &nbsp; <p-checkbox [(ngModel)]="isShareItemType" binary="true" label="Share Item Type? ">
                  </p-checkbox>

                </div>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Axes:
                </label>
                <textarea pInputTextarea [(ngModel)]="axes" cols="40" rows="5" placeholder="Enter Axes"
                  (onChange)="updateAxes(axes)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Members:
                </label>
                <textarea pInputTextarea [(ngModel)]="axesMembers" cols="40" rows="5" placeholder="Enter Members"
                  (onChange)="updateAxesMembers(axesMembers)"></textarea>
              </div>
            </div>

          </div>
          <div class="col-xs-12 col-lg-8" style="background-color: #ccc;">
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-4 input-wrapper">
                <label>
                  Division ->
                  Sector:</label>
                <p-dropdown [options]="filtereddivSector" placeholder="Select Division Sector" [(ngModel)]="divSector"
                  [style]="{'width':'100%'}" dropdownIcon="pi pi-chevron-down" (onChange)="divSectorChange(divSector)"
                  [virtualScroll]="true" [itemSize]="31" filter="true">
                </p-dropdown>
                &nbsp; {{divisionCount}}

              </div>
              <div class="col-xs-12 col-lg-4 input-wrapper">
                <label>Industry: </label>
                <p-dropdown [options]="filteredindustry" [(ngModel)]="industry" placeholder="Select Industry"
                  [showClear]="true" (onChange)="processIndustryChange(industry)" [virtualScroll]="true" [itemSize]="31"
                  filter="true" [style]="{'width':'100%'}">
                </p-dropdown>
                &nbsp; {{sectorCount}}
              </div>
              <div class="col-xs-12 col-lg-4 input-wrapper">

                <label>Filer Category:</label>
                <p-dropdown [options]="filteredfilerCategory" [(ngModel)]="filerCategory"
                  placeholder="Select Filer Category" [showClear]="true" (onChange)="processfilCatChange(filerCategory)"
                  [virtualScroll]="true" [itemSize]="31" filter="true" [style]="{'width':'100%'}">
                </p-dropdown>&nbsp;
                {{categoryCount}}
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12">
                <p-table #expressionTable [columns]="expressioncols" [value]="expTableList" [paginator]="true"
                  [rows]="10" [responsive]="true" [rowsPerPageOptions]="[10,20,30]" [resizableColumns]="true"
                  [reorderableColumns]="true" selectionMode="single" [(selection)]="termId" dataKey="termId"
                  (onRowSelect)="onRowClick($event)" (onRowUnselect)="onRowUnClick($event)" p-dataTable
                  scrollHeight="100px" [scrollable]="true" scrollHeight="200px">

                </p-table>
              </div>
            </div>
            <div class="row p-y-5">

              <div class="col-lg-12 text-center">
                <button type="button" pButton (click)="resolve()" label="Resolve"
                  class="ui-button ui-button-info"></button>&nbsp;
                <button type="button" pButton (click)="editExpression=false" label="Include"
                  class="ui-button ui-button-info"></button>&nbsp;
                <button type="button" pButton (click)="editExpression=false" label="Exclude"
                  class="ui-button ui-button-info"></button>&nbsp;
              </div>
            </div>
          </div>

        </div>
      </p-tabPanel>
      <p-tabPanel header="Formula" leftIcon="pi pi-user" rightIcon="pi pi-star" [style]="{height: '500px'}">
        <div class="row">
          <div class="col-lg-12">
            <div class="row" *ngFor="let formulaSet of formulaSets; let i = index" [attr.data-index]="i">

              <div class="col-xs-12 col-lg-3 input-wrapper">
                <label>
                  Term Name:
                </label>

                <p-autoComplete [(ngModel)]="formulaSet.termName" name="formulaTermName" [size]="50"
                  [suggestions]="formulaFilteredTerms" (completeMethod)="searchTermNames($event)"
                  placeholder="Search Term Name" [dropdown]="true">
                  <ng-template let-value pTemplate="item">
                    <div class="ui-helper-clearfix">
                      <span [innerHTML]="value"></span>
                    </div>
                  </ng-template>
                </p-autoComplete>
              </div>
              <div class="col-xs-12 col-lg-1">
                <label style="width: 100%; height: 18px;"></label>
                <p-checkbox [(ngModel)]="formulaSet.nullable" binary="true"></p-checkbox>
                &nbsp;
                <label>
                  Allow Null?
                </label>
              </div>
              <div class="col-xs-12 col-lg-2 input-wrapper">

                <label>
                  Operators:
                </label>
                <p-dropdown [options]="formulaOperatorsList" [style]="{width: '100%'}"
                  [(ngModel)]="formulaSet.operation" optionLabel="name" [showClear]="true"></p-dropdown>
              </div>
              <div class="col-xs-12 col-lg-1 text-align">
                <label style="width: 100%;"></label>
                <button type="button" pButton (click)="deleteFormula(i)" (keydown.enter)="deleteFormula(i)"
                  icon="pi pi-trash" Class="ui-button-info" pTooltip="Delete Term Name"></button>
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 text-left">
                <button type="button" pButton icon="pi pi-check" (click)="addAnotherFormula()"
                  label="Add + Another Term to Formula" class="ui-button ui-button-success"></button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Concept Match Multiple" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row p-y-5">
          <div class="col-xs-12 col-lg-6">
            <div class="row" *ngFor="let conceptSet of conceptMatchMultipleList; let i = index" [attr.data-index]="i">

              <div class="col-xs-11 col-lg-8 input-wrapper">
                <label>
                  Concept Name:
                </label>

                <p-autoComplete [(ngModel)]="conceptMatchMultiple[i]" [suggestions]="filteredconcMat"
                  (completeMethod)="filterConceptMatch($event)" [size]="80" field="id" placeholder="Enter Concept Name"
                  [minLength]="3">
                </p-autoComplete>
              </div>
              <div class="col-xs-1 col-lg-1">
                <label style="height: 18px; width: 100%;"></label>
                <button type="button" pButton (click)="deleteConceptMatchMultipleItem(i)"
                  (keydown.enter)="deleteConceptMatchMultipleItem(i)" icon="pi pi-trash" styleClass="ui-button-info"
                  pTooltip="Delete Concept"></button>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12">
                <button type="button" pButton (click)="addAnotherConcept()" label="Add + Another Concept"
                  class="ui-button ui-button-success"></button>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-4">

                <p-checkbox label="Use Positive Facts Only" [(ngModel)]="usePositiveFacts" binary="true"></p-checkbox>
              </div>
              <div class="col-xs-12 col-lg-4">

                <p-checkbox label="Use Negative Facts Only" [(ngModel)]="useNegativeFacts" binary="true"></p-checkbox>
              </div>
              <div class="col-xs-12 col-lg-4">

                <p-checkbox label="Reverse Negative Facts" [(ngModel)]="revNegativeFacts" binary="true"></p-checkbox>
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Axis:
                </label>
                <input type="text" size="30" pInputText [(ngModel)]="axis" placeholder="specify axis name">
              </div>
            </div>
            <div class="row">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Members Exclusion (Virtual Parent):
                </label>

                <textarea pInputTextarea [(ngModel)]="virtualFactMemberExclusions"
                  placeholder="Enter Exclusion Members"></textarea>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
  <p-footer>
    <button type="button" pButton icon="pi pi-check" (click)="saveExpression()" label="Save Expression"></button>
    <button type="button" pButton icon="pi pi-times" (click)="editExpression=false" label="Cancel"
      class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>
<p-dialog header="Term Validation Builder" [(visible)]="addEditValidation" [modal]="true" [style]="{width: '95vw'}"
  [baseZIndex]="10000" position="top" [contentStyle]="{'max-height':'70vh'}" [draggable]="true" [resizable]="true"
  [focusOnShow]="true" [blockScroll]="true">
  <div *ngIf="showValidation" class="alert alert-danger" role="alert">
    <strong>{{validationMessage}}</strong>
  </div>
  <div class="row p-y-5">
    <div class="col-xs-6 col-lg-3 input-wrapper">
      <label>Term Name:</label>
      <textarea pInputTextarea [(ngModel)]="termName" disabled></textarea>
    </div>

    <div class="col-xs-6 col-lg-6 input-wrapper">
      <label>Definition:</label>
      <textarea pInputTextarea [(ngModel)]="definition" disabled></textarea>
    </div>

    <div class="col-xs-6 col-lg-3 input-wrapper">
      <label>Term Code:</label>
      <textarea pInputTextarea [(ngModel)]="termCode" disabled></textarea>
    </div>
  </div>

  <div class="row p-y-5">
    <div class="col-lg-12">
      <div class="row" *ngFor="let formulaSet of formulaSets; let i = index" [attr.data-index]="i">

        <div class="col-xs-12 col-lg-3 input-wrapper">
          <label>
            Term Name:
          </label>

          <p-autoComplete [(ngModel)]="formulaSet.termName" name="formulaTermName" [size]="50"
            [suggestions]="formulaFilteredTerms" (completeMethod)="searchTermNames($event)"
            placeholder="Search Term Name" [dropdown]="true">
            <ng-template let-value pTemplate="item">
              <div class="ui-helper-clearfix">
                <span [innerHTML]="value"></span>
              </div>
            </ng-template>
          </p-autoComplete>
        </div>
        <div class="col-xs-12 col-lg-1">
          <label style="width: 100%; height: 18px;"></label>
          <p-checkbox [(ngModel)]="formulaSet.nullable" binary="true"></p-checkbox>
          &nbsp;
          <label>
            Allow Null?
          </label>
        </div>
        <div class="col-xs-12 col-lg-2 input-wrapper">

          <label>
            Operators:
          </label>
          <p-dropdown [options]="formulaOperatorsList" [style]="{width: '100%'}" [(ngModel)]="formulaSet.operation"
            optionLabel="name" [showClear]="true"></p-dropdown>
        </div>
        <div class="col-xs-12 col-lg-1 text-align">
          <label style="width: 100%;"></label>
          <button type="button" pButton (click)="deleteFormula(i)" (keydown.enter)="deleteFormula(i)" icon="pi pi-trash"
            Class="ui-button-info" pTooltip="Delete Term Name"></button>
        </div>

      </div>
      <div class="row p-y-5">
        <div class="col-lg-12 text-left">
          <button type="button" pButton icon="pi pi-check" (click)="addAnotherFormula()"
            label="Add + Another Term to Formula" class="ui-button ui-button-success"></button>
        </div>
      </div>
    </div>
  </div>

  <div class="row p-y-5">
    <div class="col-lg-12">
      <p-checkbox [(ngModel)]="showExpression" binary="true" (ngModelChange)="getValidationExpression()"></p-checkbox>
      &nbsp;
      <label>
        Show Expression ?
      </label>
    </div>
    <div class="col-lg-12" *ngIf="showExpression">
      <div class="row p-y-5">
        <div class="col-lg-12">
          <label> Rank : {{validationRank}}
          </label>
        </div>
      </div>
      <div class="row p-y-5">
        <div class="col-lg-12">
          <label> Expression : {{validationExpression}}
          </label>
        </div>
      </div>
    </div>
  </div>

  <p-footer>
    <button type="button" pButton icon="pi pi-check" (click)="addEditValidation=false; saveRuleWithValidation()"
      label="Save Validation"></button>
    <button type="button" pButton icon="pi pi-times" (click)="addEditValidation=false" label="Cancel"
      class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

<p-dialog header="Term Override Expression Builder" [(visible)]="addEditIndustry" [modal]="true"
  [style]="{width: '95vw'}" [baseZIndex]="10000" position="top" [contentStyle]="{'max-height':'70vh'}"
  [draggable]="true" [resizable]="true" [focusOnShow]="true" [blockScroll]="true">
  <div *ngIf="showValidation" class="alert alert-danger" role="alert">
    <strong>{{validationMessage}}</strong>
  </div>
  <div class="row" p-y-5>
    <div class="col-xs-6 col-lg-3 input-wrapper">
      <label>Term Name:</label>
      <textarea pInputTextarea [(ngModel)]="termName" disabled></textarea>
    </div>

    <div class="col-xs-6 col-lg-6 input-wrapper">
      <label>Definition:</label>
      <textarea pInputTextarea [(ngModel)]="definition" disabled></textarea>
    </div>

    <div class="col-xs-6 col-lg-3 input-wrapper">
      <label>Term Code:</label>
      <textarea pInputTextarea [(ngModel)]="termCode" disabled></textarea>
    </div>
  </div>

  <div class="row p-y-5">
    <div class="col-lg-12 input-wrapper">
      <label>
        Companies/Industries to override:
      </label>
    </div>
  </div>

  <div class="row">
    <div class="column" style="width:150px; margin-left: 15px;">
      <label>
        Override Name:
      </label>
    </div>
    <div class=" column2">
      <!-- <p-dropdown [options]="indovrDrpList" [(ngModel)]="overrideName" placeholder="Enter Override Name" optionLabel="name"  [style]="{'width':'400px'}" [showClear]="true"></p-dropdown> -->
      <p-autoComplete [(ngModel)]="overrideName" [suggestions]="companyovrRideList"
        (completeMethod)="getOverRides($event)" (onSelect)="getCurrentOverrideDetails()" field="name"></p-autoComplete>
      <!-- <input id="typeahead-http" type="text" class="form-control mx-sm-3"  [selectItem]="getCurrentOverrideDetails()"
            [class.is-invalid]="searchFailed" [(ngModel)]="overrideName" [ngbTypeahead]="termRule.overrides" placeholder="Enter Override Name" /> -->
    </div>
    <div class="column" style="margin-left: 15px;">
      <p-checkbox [(ngModel)]="mergeBaseExpressions" binary="true" label=" Merge Base Expressions?">
      </p-checkbox>


    </div>

  </div>

  <div class="row" style="height: 5px;"></div>
  <div *ngFor="let overrides of entityOverrides; let i = index" [attr.data-index]="i">
    <div class="row" style="margin-left: 1px;">
      <div class="column">
        <label>
          Company:
        </label>
      </div>
      <div class="column" style="margin-left: 80px">
        <p-autoComplete [(ngModel)]="overrides.entityname" name="overridecompanyName" [size]="50"
          [suggestions]="filteredCompany" (completeMethod)="searchCompany($event)" placeholder="Search Company"
          [dropdown]="true">
        </p-autoComplete>
      </div>

    </div>
    <div class="row" style="height: 5px;"></div>
    <div class="row" style="width: 100%">
      <div class="column" style="margin-left: 15px;">

        <label>
          Division -> Sector:</label>

      </div>
      <div class="column" style="margin-left: 25px;">
        <p-autoComplete [(ngModel)]="overrides.divisionSector" name="overrideDivSec" [size]="50"
          [suggestions]="filtereddivSector" (completeMethod)="searchDivisionSector($event)"
          placeholder="Search Division Sector" [dropdown]="true">
        </p-autoComplete> &nbsp;&nbsp;
        <button type="button" pButton (click)="removeOverride(i)" (keydown.enter)="removeOverride(i)" icon="pi pi-trash"
          styleClass="ui-button-info" pTooltip="Delete Override"></button>
      </div>
    </div>
    <div class="row" style="height: 5px;"></div>
  </div>
  <div class="row">
    <div class="col-lg-12">

      <button type="button" pButton icon="pi pi-check" (click)="addAnotherIndustryOverride()"
        label="Add + Another Company/Industry" class="ui-button ui-button-success"></button>
    </div>
  </div>
  <div>
    <p-tabView [activeIndex]="index" (onChange)="onTabChange($event)">
      <p-tabPanel header="Concept Match" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row">
          <div class="col-xs-12 col-lg-6">
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-6 input-wrapper">
                <label>Concept Name:</label>

                <p-autoComplete required="true" [(ngModel)]="concMatch" [suggestions]="filteredconcMat"
                  (completeMethod)="filterConceptMatch($event)" field="id" [size]="auto" placeholder="Concept Match"
                  [minLength]="3" (ngModelChange)="getconceptNameDefinition()">
                </p-autoComplete>

                <div class="padding-5" style="background-color: #ccc; text-align: left">
                  {{conceptNameDefinition}}
                </div>
              </div>
            </div>
            <div class="row  p-y-5">
              <div class="col-12">
                <div>
                  <p-checkbox label="Use Positive Facts Only" [(ngModel)]="usePositiveFacts" binary="true"></p-checkbox>
                  &nbsp;&nbsp;
                </div>
                <div>
                  <p-checkbox label="Use Negative Facts Only" [(ngModel)]="useNegativeFacts" binary="true"></p-checkbox>
                  &nbsp;&nbsp;
                </div>
                <div>
                  <p-checkbox label="Reverse Negative Facts" [(ngModel)]="revNegativeFacts" binary="true"></p-checkbox>
                </div>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-6 input-wrapper">
                <label>Axis:</label>

                <input type="text" pInputText [(ngModel)]="axis" placeholder="specify axis name">
              </div>
            </div>

            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-6 input-wrapper">
                <label>Members Exclusion (Virtual Parent):</label>

                <textarea pInputTextarea [(ngModel)]="virtualFactMemberExclusions"
                  placeholder="Enter Exclusion Members"></textarea>
              </div>
            </div>
          </div>
        </div>

      </p-tabPanel>
      <p-tabPanel header="Concept Match w/ Dim" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row">
          <div class="col-xs-12 col-lg-12">
            <div class="row" p-y-5>
              <div class="col-xs-12 col-lg-6 input-wrapper">
                <label>Concept Name:</label>

                <p-autoComplete required="true" [(ngModel)]="concMatch" [suggestions]="filteredconcMat"
                  (completeMethod)="filterConceptMatch($event)" field="id" placeholder="Concept Match" [minLength]="3"
                  (ngModelChange)="getconceptNameDefinition()">
                </p-autoComplete>
                <div class="padding-5" style="background-color: #ccc; text-align: left">
                  {{conceptNameDefinition}}
                </div>
              </div>

              <div class="col-xs-12 col-lg-6 input-wrapper">

                <p-checkbox name="useMaxAxisCount" value="useMaxAxisCount" label="Max # Axes/Members:"
                  [(ngModel)]="useMaxAxisCount" inputId="useMaxAxisCount"></p-checkbox>&nbsp;
                <input type="number" min="0" id="maxAxisCount" name="maxAxisCount" [(ngModel)]="maxAxisCount">
              </div>
            </div>

            <div class="row p-y-5" *ngFor="let expressionSet of expressionSets; let i = index" [attr.data-index]="i">

              <div class="col-lg-12">
                <div class="row p-y-5">
                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>Axes:
                      <p-radioButton name="axisOption{{i}}" value="ExactMatch" [(ngModel)]="expressionSet.axisType"
                        id="axisFullNameOption"
                        (onClick)="OnExpressionAxisTypeChanged(i); expressionSet.disableAxes=false;expressionSet.disableAxesInc=true">
                      </p-radioButton>
                    </label>
                    <input type="text" size="30" pInputText [(ngModel)]="expressionSet.axisName"
                      placeholder="specify axis name" [disabled]="expressionSet.disableAxes">
                  </div>
                </div>

                <div class="row p-y-5">
                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>
                      <p-radioButton name="axisOption{{i}}" id="axisPartialNameOption" value="InclusionExclusionList"
                        [(ngModel)]="expressionSet.axisType"
                        (onClick)="OnExpressionAxisTypeChanged(i);expressionSet.disableAxesInc=false;expressionSet.disableAxes=true">
                      </p-radioButton>
                      Inclusions(axis name must
                      contain the list of words):
                    </label>
                    <textarea pInputTextarea id="axisInclusionList" name="axisInclusionList"
                      [disabled]="expressionSet.disableAxesInc" placeholder="Enter Inclusion Axes"
                      [(ngModel)]="expressionSet.axisInclusionListAsString" cols="50" placeholder="Enter Exclusion Axes"
                      (onChange)="expressionSet.axisInclusionList = buildListFromString(expressionSet.axisInclusionListAsString)"></textarea>
                  </div>


                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>
                      Exclusions (axis name must NOT
                      contain the list of words):
                    </label>
                    <textarea pInputTextarea id="axisExclusions" name="axisExclusions"
                      [disabled]="expressionSet.disableAxesInc" [(ngModel)]="expressionSet.axisExclusionListAsString"
                      cols="50" placeholder="Enter Exclusion Axes"
                      (onChange)="expressionSet.axisExclusionList = buildListFromString(expressionSet.axisExclusionListAsString)"></textarea>
                  </div>
                </div>

                <div class="row p-y-5">
                  <div class="col-lg-12 p-y-0">
                    <label>
                      Members:
                    </label>

                    <label>
                      <p-radioButton name="memberOption{{i}}" id="anyMemberOption" value="Any"
                        [(ngModel)]="expressionSet.memberType" (onClick)="OnExpressionMemberTypeChanged(i)">
                      </p-radioButton>
                      Any Members:
                    </label>
                    <div class="p-y-5">
                      <p-radioButton name="memberOption{{i}}" value="ExactMatch" [(ngModel)]="expressionSet.memberType"
                        (onClick)="OnExpressionMemberTypeChanged(i); expressionSet.disableMember=false;expressionSet.disableMemInc=true">
                      </p-radioButton>
                      <input type="text" size="30" pInputText [(ngModel)]="expressionSet.memberName"
                        placeholder="specify member name" [disabled]="expressionSet.disableMember">

                    </div>
                  </div>
                </div>

                <div class="row p-y-5">
                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>
                      <p-radioButton name="memberOption{{i}}" value="InclusionExclusionList"
                        [(ngModel)]="expressionSet.memberType" inputId="partialMemberOption"
                        (onClick)="OnExpressionMemberTypeChanged(i);expressionSet.disableMember=true; expressionSet.disableMemInc=false">
                      </p-radioButton>
                      Inclusions(member name must
                      contain the list of words):
                    </label>
                    <textarea pInputTextarea [(ngModel)]="expressionSet.memberInclusionListAsString" cols="50"
                      placeholder="Enter Exclusion Members" [disabled]="expressionSet.disableMemInc"
                      (onChange)="expressionSet.memberInclusionList = buildListFromString(expressionSet.memberInclusionListAsString)"></textarea>
                  </div>


                  <div class="col-xs-12 col-lg-6 input-wrapper">
                    <label>
                      Exclusions (member name must NOT
                      contain the list of words):
                    </label>
                    <textarea pInputTextarea [(ngModel)]="expressionSet.memberExclusionListAsString" cols="50"
                      placeholder="Enter Exclusion Members" [disabled]="expressionSet.disableMemInc"
                      (onChange)="expressionSet.memberExclusionList = buildListFromString(expressionSet.memberExclusionListAsString)"></textarea>
                  </div>
                </div>
              </div>
              <div class="col-lg-12 text-center">
                <button type="button" pButton icon="pi pi-times" (click)="removeSet(i)" label="Remove Set"
                  class="ui-button ui-button-success"></button>
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 text-center">
                <button type="button" pButton icon="pi pi-check" (click)="AddExpressionSet()" label="Add New Set"
                  class="ui-button ui-button-success"></button>
              </div>
            </div>

          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Extended Check" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row">
          <div class="col-xs-12 col-lg-4">
            <div class="row">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Element Name Contains:
                </label>
                <textarea pInputTextarea [(ngModel)]="nameContains" cols="40" rows="5" placeholder="Name Contains"
                  (ngModelChange)="updateNameContains(nameContains)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Element Name does not Contain:
                </label>
                <textarea pInputTextarea [(ngModel)]="nameDoesNotContains" cols="40" rows="5"
                  placeholder="Name Does Not Contain"
                  (ngModelChange)="updateNameNotContains(nameDoesNotContains)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Balance Type:
                </label>
                <div>
                  &nbsp; <p-radioButton name="ExtendedGroup" value="debit" label="Debit" [(ngModel)]="balType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="ExtendedGroup" value="credit" label="Credit" [(ngModel)]="balType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="ExtendedGroup" value="na" label="NA" [(ngModel)]="balType">
                  </p-radioButton> &nbsp;
                  <p-radioButton name="ExtendedGroup" value="none" label="Ignore" [(ngModel)]="balType">
                  </p-radioButton> &nbsp;
                </div>
              </div>
            </div>

            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Period Type:
                </label>
                <div>
                  &nbsp; <p-radioButton name="perTypeGroup" value="instant" label="Instant" [(ngModel)]="perType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="perTypeGroup" value="duration" label="duration" [(ngModel)]="perType">
                  </p-radioButton>
                  &nbsp;

                </div>
                <div class="p-y-5">
                  &nbsp; <p-checkbox [(ngModel)]="isShareItemType" binary="true" label="Share Item Type? ">
                  </p-checkbox>

                </div>
              </div>
            </div>
          </div>
          <div class="col-xs-12 col-lg-8" style="background-color: #ccc;">
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-4 input-wrapper">
                <label>
                  Division ->
                  Sector:</label>
                <p-dropdown [options]="filtereddivSector" placeholder="Select Division Sector" [(ngModel)]="divSector"
                  [style]="{'width':'100%'}" dropdownIcon="pi pi-chevron-down" (onChange)="divSectorChange(divSector)"
                  [virtualScroll]="true" [itemSize]="31" filter="true">
                </p-dropdown>
                &nbsp; {{divisionCount}}

              </div>
              <div class="col-xs-12 col-lg-4 input-wrapper">
                <label>Industry: </label>

                <p-dropdown [options]="filteredindustry" [(ngModel)]="industry" placeholder="Select Industry"
                  [showClear]="true" (onChange)="processIndustryChange(industry)" [virtualScroll]="true" [itemSize]="31"
                  filter="true" [style]="{'width':'100%'}">
                </p-dropdown>
                &nbsp; {{sectorCount}}
              </div>
              <div class="col-xs-12 col-lg-4 input-wrapper">

                <label>Filer Category:</label>
                <p-dropdown [options]="filteredfilerCategory" [(ngModel)]="filerCategory"
                  placeholder="Select Filer Category" [showClear]="true" (onChange)="processfilCatChange(filerCategory)"
                  [virtualScroll]="true" [itemSize]="31" filter="true" [style]="{'width':'100%'}">
                </p-dropdown>&nbsp;
                {{categoryCount}}
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12">
                <p-table #expressionTable [columns]="expressioncols" [value]="expTableList" [paginator]="true"
                  [rows]="10" [responsive]="true" [rowsPerPageOptions]="[10,20,30]" [resizableColumns]="true"
                  [reorderableColumns]="true" selectionMode="single" [(selection)]="termId" dataKey="termId"
                  (onRowSelect)="onRowClick($event)" (onRowUnselect)="onRowUnClick($event)" p-dataTable
                  scrollHeight="100px" [scrollable]="true" scrollHeight="200px">

                </p-table>
              </div>
            </div>
            <div class="row p-y-5">

              <div class="col-lg-12 text-center">
                <button type="button" pButton (click)="resolve()" label="Resolve"
                  class="ui-button m-x-5 ui-button-info"></button>&nbsp;
                <button type="button" pButton (click)="editExpression=false" label="Include"
                  class="ui-button m-x-5 ui-button-info"></button>&nbsp;
                <button type="button" pButton (click)="editExpression=false" label="Exclude"
                  class="ui-button m-x-5 ui-button-info"></button>&nbsp;
              </div>
            </div>
          </div>

        </div>
      </p-tabPanel>
      <p-tabPanel header="Extended Check w/ Dim" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row">
          <div class="col-xs-12 col-lg-4">
            <div class="row">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Element Name Contains:
                </label>
                <textarea pInputTextarea [(ngModel)]="nameContains" cols="40" rows="5" placeholder="Name Contains"
                  (ngModelChange)="updateNameContains(nameContains)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Element Name does not Contain:
                </label>
                <textarea pInputTextarea [(ngModel)]="nameDoesNotContains" cols="40" rows="5"
                  placeholder="Name Does Not Contain"
                  (ngModelChange)="updateNameNotContains(nameDoesNotContains)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Balance Type:
                </label>
                <div>
                  &nbsp; <p-radioButton name="ExtendedGroup" value="debit" label="Debit" [(ngModel)]="balType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="ExtendedGroup" value="credit" label="Credit" [(ngModel)]="balType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="ExtendedGroup" value="na" label="NA" [(ngModel)]="balType">
                  </p-radioButton> &nbsp;
                  <p-radioButton name="ExtendedGroup" value="none" label="Ignore" [(ngModel)]="balType">
                  </p-radioButton> &nbsp;
                </div>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Period Type:
                </label>
                <div>
                  &nbsp; <p-radioButton name="radioGroup1" value="instant" label="Instant" [(ngModel)]="perType">
                  </p-radioButton>
                  &nbsp;
                  <p-radioButton name="radioGroup1" value="duration" label="duration" [(ngModel)]="perType">
                  </p-radioButton>
                  &nbsp;

                </div>
                <div class="p-y-5">
                  &nbsp; <p-checkbox [(ngModel)]="isShareItemType" binary="true" label="Share Item Type? ">
                  </p-checkbox>

                </div>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Axes:
                </label>
                <textarea pInputTextarea [(ngModel)]="axes" cols="40" rows="5" placeholder="Enter Axes"
                  (onChange)="updateAxes(axes)"></textarea>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Members:
                </label>
                <textarea pInputTextarea [(ngModel)]="axesMembers" cols="40" rows="5" placeholder="Enter Members"
                  (onChange)="updateAxesMembers(axesMembers)"></textarea>
              </div>
            </div>

          </div>
          <div class="col-xs-12 col-lg-8" style="background-color: #ccc;">
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-4 input-wrapper">
                <label>
                  Division ->
                  Sector:</label>
                <p-dropdown [options]="filtereddivSector" placeholder="Select Division Sector" [(ngModel)]="divSector"
                  [style]="{'width':'100%'}" dropdownIcon="pi pi-chevron-down" (onChange)="divSectorChange(divSector)"
                  [virtualScroll]="true" [itemSize]="31" filter="true">
                </p-dropdown>
                &nbsp; {{divisionCount}}

              </div>
              <div class="col-xs-12 col-lg-4 input-wrapper">
                <label>Industry: </label>
                <p-dropdown [options]="filteredindustry" [(ngModel)]="industry" placeholder="Select Industry"
                  [showClear]="true" (onChange)="processIndustryChange(industry)" [virtualScroll]="true" [itemSize]="31"
                  filter="true" [style]="{'width':'100%'}">
                </p-dropdown>
                &nbsp; {{sectorCount}}
              </div>
              <div class="col-xs-12 col-lg-4 input-wrapper">

                <label>Filer Category:</label>
                <p-dropdown [options]="filteredfilerCategory" [(ngModel)]="filerCategory"
                  placeholder="Select Filer Category" [showClear]="true" (onChange)="processfilCatChange(filerCategory)"
                  [virtualScroll]="true" [itemSize]="31" filter="true" [style]="{'width':'100%'}">
                </p-dropdown>&nbsp;
                {{categoryCount}}
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12">
                <p-table #expressionTable [columns]="expressioncols" [value]="expTableList" [paginator]="true"
                  [rows]="10" [responsive]="true" [rowsPerPageOptions]="[10,20,30]" [resizableColumns]="true"
                  [reorderableColumns]="true" selectionMode="single" [(selection)]="termId" dataKey="termId"
                  (onRowSelect)="onRowClick($event)" (onRowUnselect)="onRowUnClick($event)" p-dataTable
                  scrollHeight="100px" [scrollable]="true" scrollHeight="200px">

                </p-table>
              </div>
            </div>
            <div class="row p-y-5">

              <div class="col-lg-12 text-center">
                <button type="button" pButton (click)="resolve()" label="Resolve"
                  class="ui-button ui-button-info"></button>&nbsp;
                <button type="button" pButton (click)="editExpression=false" label="Include"
                  class="ui-button ui-button-info"></button>&nbsp;
                <button type="button" pButton (click)="editExpression=false" label="Exclude"
                  class="ui-button ui-button-info"></button>&nbsp;
              </div>
            </div>
          </div>

        </div>
      </p-tabPanel>
      <p-tabPanel header="Formula" leftIcon="pi pi-user" rightIcon="pi pi-star" [style]="{height: '500px'}">
        <div class="row">
          <div class="col-lg-12">
            <div class="row" *ngFor="let formulaSet of formulaSets; let i = index" [attr.data-index]="i">

              <div class="col-xs-12 col-lg-3 input-wrapper">
                <label>
                  Term Name:
                </label>

                <p-autoComplete [(ngModel)]="formulaSet.termName" name="formulaTermName" [size]="50"
                  [suggestions]="formulaFilteredTerms" (completeMethod)="searchTermNames($event)"
                  placeholder="Search Term Name" [dropdown]="true">
                  <ng-template let-value pTemplate="item">
                    <div class="ui-helper-clearfix">
                      <span [innerHTML]="value"></span>
                    </div>
                  </ng-template>
                </p-autoComplete>
              </div>
              <div class="col-xs-12 col-lg-1">
                <label style="width: 100%; height: 18px;"></label>
                <p-checkbox [(ngModel)]="formulaSet.nullable" binary="true"></p-checkbox>
                &nbsp;
                <label>
                  Allow Null?
                </label>
              </div>
              <div class="col-xs-12 col-lg-2 input-wrapper">

                <label>
                  Operators:
                </label>
                <p-dropdown [options]="formulaOperatorsList" [style]="{width: '100%'}"
                  [(ngModel)]="formulaSet.operation" optionLabel="name" [showClear]="true"></p-dropdown>
              </div>
              <div class="col-xs-12 col-lg-1 text-align">
                <label style="width: 100%;"></label>
                <button type="button" pButton (click)="deleteFormula(i)" (keydown.enter)="deleteFormula(i)"
                  icon="pi pi-trash" Class="ui-button-info" pTooltip="Delete Term Name"></button>
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 text-left">
                <button type="button" pButton icon="pi pi-check" (click)="addAnotherFormula()"
                  label="Add + Another Term to Formula" class="ui-button ui-button-success"></button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Concept Match Multiple" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row p-y-5">
          <div class="col-xs-12 col-lg-6">
            <div class="row" *ngFor="let conceptSet of conceptMatchMultipleList; let i = index" [attr.data-index]="i">

              <div class="col-xs-11 col-lg-8 input-wrapper">
                <label>
                  Concept Name:
                </label>

                <p-autoComplete [(ngModel)]="conceptMatchMultiple[i]" [suggestions]="filteredconcMat"
                  (completeMethod)="filterConceptMatch($event)" [size]="80" field="id" placeholder="Enter Concept Name"
                  [minLength]="3">
                </p-autoComplete>
              </div>
              <div class="col-xs-1 col-lg-1">
                <label style="height: 18px; width: 100%;"></label>
                <button type="button" pButton (click)="deleteConceptMatchMultipleItem(i)"
                  (keydown.enter)="deleteConceptMatchMultipleItem(i)" icon="pi pi-trash" styleClass="ui-button-info"
                  pTooltip="Delete Concept"></button>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12">
                <button type="button" pButton (click)="addAnotherConcept()" label="Add + Another Concept"
                  class="ui-button ui-button-success"></button>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-xs-12 col-lg-4">

                <p-checkbox label="Use Positive Facts Only" [(ngModel)]="usePositiveFacts" binary="true"></p-checkbox>
              </div>
              <div class="col-xs-12 col-lg-4">

                <p-checkbox label="Use Negative Facts Only" [(ngModel)]="useNegativeFacts" binary="true"></p-checkbox>
              </div>
              <div class="col-xs-12 col-lg-4">

                <p-checkbox label="Reverse Negative Facts" [(ngModel)]="revNegativeFacts" binary="true"></p-checkbox>
              </div>

            </div>
            <div class="row p-y-5">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Axis:
                </label>
                <input type="text" size="30" pInputText [(ngModel)]="axis" placeholder="specify axis name">
              </div>
            </div>
            <div class="row">
              <div class="col-lg-12 input-wrapper">
                <label>
                  Members Exclusion (Virtual Parent):
                </label>

                <textarea pInputTextarea [(ngModel)]="virtualFactMemberExclusions"
                  placeholder="Enter Exclusion Members"></textarea>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
  <p-footer>
    <button type="button" pButton icon="pi pi-check" (click)="saveExpression()" label="Save Expression"></button>
    <button type="button" pButton icon="pi pi-times" (click)="addEditIndustry=false; editExpression=false;"
      label="Cancel" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

<p-dialog header="Term Derived Zero Expression Builder" [(visible)]="addEditDerived" [modal]="true"
  [style]="{width: '95vw'}" [baseZIndex]="10000" position="top" [contentStyle]="{'max-height':'70vh'}"
  [draggable]="true" [resizable]="true" [focusOnShow]="true" [blockScroll]="true">
  <div *ngIf="showValidation" class="alert alert-danger" role="alert">
    <strong>{{validationMessage}}</strong>
  </div>
  <div class="row p-y-5">
    <div class="col-xs-6 col-lg-3 input-wrapper">
      <label>Term Name:</label>
      <textarea pInputTextarea [(ngModel)]="termName" disabled></textarea>
    </div>

    <div class="col-xs-6 col-lg-6 input-wrapper">
      <label>Definition:</label>
      <textarea pInputTextarea [(ngModel)]="definition" disabled></textarea>
    </div>

    <div class="col-xs-6 col-lg-3 input-wrapper">
      <label>Term Code:</label>
      <textarea pInputTextarea [(ngModel)]="termCode" disabled></textarea>
    </div>
  </div>

  <div>
    <p-tabView [activeIndex]="activeExpressionTabIndex" (onChange)="onDerivedTabChange($event)">
      <p-tabPanel header="Text Block Check" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row p-y-5">
          <div class="col-xs-12 col-lg-6">
            <div class="row" *ngFor="let item of derivedZeroExpressionForEdit.textBlockList; let i = index"
              [attr.data-index]="i">

              <div class="col-xs-11 col-lg-8 input-wrapper">
                <label>
                  Text Block: {{filteredtext[i]}}
                </label>

                <p-autoComplete [(ngModel)]="item.expressionItem" name="textblock" [size]="80" field="id"
                  [suggestions]="filteredconcMat" (completeMethod)="filterConceptMatch($event)"
                  placeholder="Search Term Name">
                </p-autoComplete>
              </div>
              <div class="col-xs-1 col-lg-1">
                <label style="height: 14px; width: 100%;"></label>
                <button type="button" pButton (click)="removeTextBlock(i)" (keydown.enter)="removeTextBlock(i)"
                  icon="pi pi-trash" styleClass="ui-button-info" pTooltip="Delete Term Name"></button>

              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12">
                <button type="button" pButton icon="pi pi-check" (click)="addAnotherTextBlock()"
                  label="Add + Another Text Block" class="ui-button ui-button-success"></button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Dependent Terms" leftIcon="pi pi-user" rightIcon="pi pi-star">

        <div class="row p-y-5">
          <div class="col-lg-12">
            <p-checkbox [(ngModel)]="derivedZeroExpressionForEdit.allTermsRequired" binary="true"
              label="Dependent on all terms?">
            </p-checkbox>
          </div>
        </div>

        <div class="row p-y-5">
          <div class="col-xs-12 col-lg-6">
            <div class="row" *ngFor="let item of derivedZeroExpressionForEdit.depTermNameList; let i = index"
              [attr.data-index]="i">

              <div class="col-xs-11 col-lg-8 input-wrapper">
                <label>
                  Term Name:
                </label>

                <p-autoComplete [(ngModel)]="item.expressionItem" name="formulaTermName" [size]="72"
                  [suggestions]="formulaFilteredTerms" (completeMethod)="searchTermNames($event)"
                  placeholder="Search Term Name" [dropdown]="true">
                  <ng-template let-value pTemplate="item">
                    <div class="ui-helper-clearfix">
                      <span [innerHTML]="value"></span>
                    </div>
                  </ng-template>
                </p-autoComplete>
              </div>
              <div class="col-xs-1 col-lg-1">
                <label style="height: 14px; width: 100%;"></label>
                <button type="button" pButton (click)="removeDerivedTerm(i)"
                  (keydown.enter)="removeDerivedTerm(i, false)" icon="pi pi-trash" styleClass="ui-button-info"
                  pTooltip="Delete Term Entry"></button>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12">
                <button type="button" pButton icon="pi pi-check" (click)="addAnotherItem(false)"
                  label="Add + Another Term" class="ui-button ui-button-success"></button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Exclusive Terms" leftIcon="pi pi-user" rightIcon="pi pi-star">

        <div class="row p-y-5">
          <div class="col-xs-12 col-lg-6">
            <div class="row" *ngFor="let item of derivedZeroExpressionForEdit.excTermNameList; let i = index"
              [attr.data-index]="i">

              <div class="col-xs-11 col-lg-8 input-wrapper">
                <label>
                  Term Name:
                </label>

                <p-autoComplete [(ngModel)]="item.expressionItem" name="formulaTermName" [size]="72"
                  [suggestions]="formulaFilteredTerms" (completeMethod)="searchTermNames($event)"
                  placeholder="Search Term Name" [dropdown]="true">
                  <ng-template let-value pTemplate="item">
                    <div class="ui-helper-clearfix">
                      <span [innerHTML]="value"></span>
                    </div>
                  </ng-template>
                </p-autoComplete>

              </div>
              <div class="col-xs-1 col-lg-1">
                <label style="height: 14px; width: 100%;"></label><button type="button" pButton
                  (click)="removeDerivedTerm(i)" (keydown.enter)="removeDerivedTerm(i, true)" icon="pi pi-trash"
                  styleClass="ui-button-info" pTooltip="Delete Term Entry"></button>
              </div>
            </div>
            <div class="row p-y-5">
              <div class="col-lg-12">
                <button type="button" pButton icon="pi pi-check" (click)="addAnotherItem(true)"
                  label="Add + Another Term" class="ui-button ui-button-success"></button>
              </div>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Exclusive Division->Sector" leftIcon="pi pi-user" rightIcon="pi pi-star">
        <div class="row">
          <div class="col-xs-12 col-lg-4 input-wrapper">
            <label>Division -> Sector:</label>
            <p-dropdown [options]="filteredDeriveddivSectors" placeholder="Select Division Sector"
              [(ngModel)]="deriveddivSector" [style]="{'width':'100%'}" dropdownIcon="pi pi-chevron-down"
              (onChange)="derivedDivisionSeleted($event)" [virtualScroll]="true" [itemSize]="31" filter="true">
            </p-dropdown>
            <span>
              {{divisionCount}}
            </span>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12 col-lg-4 input-wrapper">
            <label>Industry: </label>
            <p-dropdown [options]="filteredDerivedindustry" placeholder="Select Industry" [(ngModel)]="derivedindustry"
              [style]="{'width':'100%'}" dropdownIcon="pi pi-chevron-down" (onChange)="industryChanged($event)"
              filter="true">
            </p-dropdown>
            <span>
              {{sectorCount}}
            </span>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>

  <p-footer>
    <button type="button" pButton icon="pi pi-check" (click)="addEditDerived=false; saveNewDerivedExpression()"
      label="Save Derived Expression"></button>
    <button type="button" pButton icon="pi pi-times" (click)="addEditDerived=false; " label="Cancel"
      class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

<p-dialog header="Expression For {{termId}}" [(visible)]="displayTermTreeModal" [modal]="true"
  [style]="{width: '95vw', overflow: 'auto'}" [baseZIndex]="10000" position="top" [contentStyle]="{'max-height':'70vh'}"
  [draggable]="true" [resizable]="true" [focusOnShow]="true" [blockScroll]="true">
  <div class="row" p-y-5>
    <div class="col-xs-12 col-lg-7" id="termRulesTreeTable">
      <p-treeTable [value]="treeData.data" [columns]="treeCol">
        <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
          <tr>
            <td *ngFor="let col of columns; let i = index" ttEditableColumn [ngClass]="{'ui-toggler-column': i === 0}">
              <p-treeTableToggler [rowNode]="rowNode" *ngIf="i === 0"></p-treeTableToggler>
              <a href="#"
                [ngClass]="{'selected-node': ((selectedTreeNode['childId'] === rowData['childId']) && (selectedTreeNode['parent'] === rowData['parent']) && (selectedTreeNode['id'] === rowData['id']))}"
                (click)="showTermRuleResultnavigateTree($event,rowData)">
                {{rowData[col.field]}}
              </a>
              <!-- <span *ngIf="rowData['hasChildren']"> {{rowData[col.field]}}</span> -->
            </td>
          </tr>
        </ng-template>
      </p-treeTable>
    </div>
    <div class="col-xs-12 col-lg-5" *ngIf="modalExpTableData && modalExpTableData.name && modalExpTableData.termId">
      <div style=" margin-bottom: 5px; font-weight: 700; font-size: 14px; text-align: center;">Expression table for
        {{modalExpTableData.name}} ({{modalExpTableData.termId}})</div>

      <p-table #modalExpressionTable [columns]="modalExpressioncols" [value]="modalExpTableList" [paginator]="true"
        [rows]="10" [responsive]="true" [rowsPerPageOptions]="[10,20,30]" [resizableColumns]="true"
        [reorderableColumns]="true" selectionMode="single" [(selection)]="termId" dataKey="termId" p-dataTable
        [scrollable]="true" scrollHeight="400px">
        <ng-template pTemplate="colgroup" let-columns>
          <colgroup>
            <col *ngFor="let col of columns" [style.width]="col.width">
          </colgroup>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th *ngFor="let col of columns" pResizableColumn pReorderableColumn [pSortableColumn]="col.field">
              <div>
                {{col.header}}
              </div>
            </th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
          <tr style="height:34px">
            <td *ngFor="let col of columns " class="ui-resizable-column" style="word-wrap:break-word">
              <div *ngIf="col.field === 'rank'">
                {{rowData[col.field]}}
              </div>
              <div *ngIf="col.field !== 'rank' && col.field !== 'options' && col.field !== 'expression'">
                {{rowData[col.field]}}
              </div>
              <div *ngIf="col.field === 'expression'">
                <div *ngIf="rowData['type'] !== 'Formula'">
                  {{rowData[col.field]}}
                </div>

                <div *ngIf="rowData['type'] === 'Formula'">
                  <p style="display:inline" *ngFor="let formula of rowData['formulaList']">
                    <a href="#" (click)="showTermRuleResultnavigate($event,formula.termName)">{{formula.termName}}
                    </a>
                    {{getFormulaSuffix(formula)}}
                  </p>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody" let-columns="columns">
          <tr style="height:34px">
            <td *ngFor="let col of columns" pTooltip="{{rowData[col.field]}}">
              <div class="loading-text"></div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="summary">
          Total number of Records: {{expressionTable.totalRecords}}
        </ng-template>
      </p-table>
    </div>
  </div>
  <p-footer>
    <!-- <button type="button" pButton icon="pi pi-check" (click)="editExpression=false; saveExpression()"
      label="Save Expression"></button> -->
    <button type="button" pButton icon="pi pi-times" (click)="displayTermTreeModal=false" label="Cancel"
      class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

<span *ngFor="let entity of entityList; let i = index;">
  <div
    [ngStyle]="{'display': showTermResultsWindow[i] ? 'block' : 'none', 'margin-left': showTermResultsWindowMinimize[i] ? '5px' : '0px', 'width': showTermResultsWindowMinimize[i] ? minimizeWidth : 'auto', 'background-color': showTermResultsWindowMinimize[i] ? '#f4f4f4' : ''  }"
    [ngDraggable]="!showTermResultsWindowMinimize[i]" [ngResizable]="!showTermResultsWindowMinimize[i]" class="modal"
    [ngClass]="showTermResultsWindowMinimize[i] ? 'minimize-modal modal' + i : 'modal' + i ">

    <div *ngIf="showTermResultsWindowMinimize[i]" style="padding: 0px 5px;">
      <span style="position: relative; top: 12px;; font-weight: bolder;">{{state[i].companyName | slice:0:13}}</span>

      <span class="float-right">
        <span (click)="maximizeModal(i)" class="maximize">+</span>
        <span (click)="close(i)" style="position: relative; top: 8px;" class="close">&times;</span>
      </span>
    </div>

    <div class="modal-content" *ngIf="!showTermResultsWindowMinimize[i]">
      <div class="row modal-header" [ngStyle]="{'margin': showTermResultsWindowMinimize[i] ? '0px' : '0px -15px' }">
        <div class="col-12" [ngStyle]="{'padding': showTermResultsWindowMinimize[i] ? '0px' : '5px' }">

          <span class="float-right">
            <span (click)="minimizeModal(i)" class="minimize">-</span>
            <span (click)="close(i)" class="close">&times;</span>
          </span>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <app-term-result *ngIf="showTermResultsWindow[i]" [state]="state[i]"></app-term-result>
        </div>
      </div>
      <div class="row">
        <div class="col-12" style="padding: 10px 5px;">
          <button type="button" pButton icon="pi pi-times" (click)="showTermResultsWindow[i]=false" label="Cancel"
            class="ui-button-secondary float-right"></button>
        </div>
      </div>
    </div>

  </div>

  <!-- <p-dialog header="" [(visible)]="showTermResultsWindow[i]" [style]="{width: '95vw', overflow: 'auto'}"
    [draggable]="true" [maximizable]="true" [resizable]="true" [contentStyle]="{'max-height':'70vh'}">
    <app-term-result [state]="state[i]"></app-term-result>

    <p-footer>

      <button type="button" pButton icon="pi pi-times" (click)="showTermResultsWindow[i]=false" label="Cancel"
        class="ui-button-secondary"></button>
    </p-footer>
  </p-dialog> -->
</span>

<ng-template #termRuleSelectionSection>
  <div>The Term list shows the complete list of term rules.>
    <div>
      <ol>
        <li>
          The display is a hierarchical list, group by financial statements and sorted by term names. The term names are
          aligned to Compustat term codes when applicable.
        </li>
        <li>
          You can "filter" by typing in the filter text box. Example, filter by "intangible":
        </li>
      </ol>
    </div>

  </div>
</ng-template>

<ng-template #periodTypeSection>
  <div>The dropdown determines what specific period type the selected term represents.</div>
  <div>Options include: Instant, Duration, and NA. </div>
</ng-template>

<ng-template #typeSection>
  <div>This dropdown determines what type the selected term represents. </div>
  <div>Options include: Decimal, Integer, Monetary, PerShare, Ratio, Shares, and NA.</div>
</ng-template>

<ng-template #financialStatementSection>
  <div>This dropdown determines what financial statement the selected term represents. </div>
  <div>Options include: Various Balance sheet, Income Statement, and Statement of Cash Flows selections.</div>
</ng-template>

<ng-template #priorityGroupSection>
  <div>This dropdown determines what priority group the selected term is classified. </div>
  <div>Options include: Priority groups A through J.</div>
</ng-template>

<ng-template #addTermSection>
  <div>The user click on the “Add Term” to add a new term. </div>
  <div>The detail pane would be blanked out to allow the user to enter a new term. </div>
  <div>The term name and code need to be unique.</div>
</ng-template>

<ng-template #removeTermSection>
  <div>The user can click on the “Remove Term” to remove the term.</div>
  <div>The user will need to confirm the action.</div>
</ng-template>

<ng-template #expLabelSection>
  <div>The user can click on the “Add Expression” to add an additional expressions to the term rule. </div>
  <div>Please view the “Expression Parser/Builder” section to review details of how to build expressions for different
    expression types.</div>
</ng-template>
